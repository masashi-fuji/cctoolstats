---
priority: 2
tags: ["subagents", "testing", "refactoring", "development"]
description: "cctoolstatsプロジェクトのテストコードリファクタリングを支援する8つの専門サブエージェントを作成する"
created_at: "2025-08-10T02:08:42Z"
started_at: null  # Do not modify manually
closed_at: null   # Do not modify manually
---

# テストリファクタリング用サブエージェント群の作成

## 概要

cctoolstatsプロジェクトのテストコードリファクタリングを支援する8つの専門サブエージェントを作成する。
これらのサブエージェントは、テストコードの品質向上、実行時間短縮、保守性改善を目的とする。

## タスク

### Phase 1: 基盤サブエージェント（必須）
- [ ] test-factory-generator: テストヘルパー/ファクトリの自動生成サブエージェント作成
  - [ ] `.claude/agents/test-factory-generator.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

- [ ] test-migration-validator: リファクタリング前後の動作検証サブエージェント作成
  - [ ] `.claude/agents/test-migration-validator.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

### Phase 2: コア機能サブエージェント
- [ ] test-pattern-refactorer: AAAパターンへの自動変換サブエージェント作成
  - [ ] `.claude/agents/test-pattern-refactorer.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

- [ ] test-coverage-analyzer: カバレッジ分析とギャップ特定サブエージェント作成
  - [ ] `.claude/agents/test-coverage-analyzer.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

### Phase 3: 品質向上サブエージェント
- [ ] test-performance-optimizer: テスト実行高速化サブエージェント作成
  - [ ] `.claude/agents/test-performance-optimizer.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

- [ ] test-edge-case-generator: エッジケース体系的生成サブエージェント作成
  - [ ] `.claude/agents/test-edge-case-generator.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

### Phase 4: 最適化サブエージェント
- [ ] test-deduplication-analyzer: 重複テスト検出・統合サブエージェント作成
  - [ ] `.claude/agents/test-deduplication-analyzer.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

- [ ] test-documentation-generator: ドキュメント自動生成サブエージェント作成
  - [ ] `.claude/agents/test-documentation-generator.md` ファイル作成（YAMLフロントマター付き）
  - [ ] t_wada式TDD哲学に基づく振る舞いの実装
  - [ ] エラーハンドリングの実装
  - [ ] サブエージェント自体のテスト作成
  - [ ] ドキュメントの作成
  - [ ] 統合テストの実施

### 完了条件
- [ ] 全8つのサブエージェントが作成され、動作確認済み
- [ ] 各サブエージェントのドキュメントが完成
- [ ] 統合テストで全サブエージェントが正常に動作
- [ ] Run tests before closing and pass all tests (No exceptions)
- [ ] Get developer approval before closing

## 期待される成果

- **テストカバレッジ**: 70% → 85%への向上
- **テスト実行時間**: 50%短縮
- **テストコード量**: 30%削減（重複排除と最適化による）
- **バグ検出率**: 40%向上（エッジケースの体系的生成による）

## 各サブエージェントの詳細

**重要**: すべてのサブエージェントは、t_wada氏が提唱するKent Beck流のTDD原則に厳格に従い、以下の哲学を体現します：
- Red-Green-Refactorサイクルの徹底
- 「テストを書いてから実装」の厳守
- シンプルで明確なテストコードの追求
- 「偽装を経て三角測量へ」の実践

### 1. test-factory-generator
- **目的**: テストデータ生成の共通化と効率化
- **機能**: テストヘルパー関数、ファクトリパターンの自動生成
- **効果**: テストコードの重複削減、保守性向上
- **TDD責務**: 「t_wadaだったら、まずテストデータの生成コード自体をテスト駆動で作る。ファクトリは最小限から始め、必要に応じて拡張する。過度な抽象化は避け、YAGNI原則を守る」

### 2. test-migration-validator
- **目的**: リファクタリング時の安全性保証
- **機能**: 変更前後のテスト結果の比較検証
- **効果**: リファクタリングによる不具合の防止
- **TDD責務**: 「t_wadaだったら、リファクタリングは緑の状態でのみ行う。テストが通っている状態を維持しながら、小さなステップで進める。決して機能追加とリファクタリングを同時に行わない」

### 3. test-pattern-refactorer
- **目的**: テストコードの構造化と可読性向上
- **機能**: Arrange-Act-Assert (AAA) パターンへの自動変換
- **効果**: テストコードの理解しやすさ向上
- **TDD責務**: 「t_wadaだったら、テストは仕様書として読めるべき。AAAパターンで構造化し、一つのテストは一つの振る舞いのみを検証する。テストメソッド名は期待される振る舞いを明確に表現する」

### 4. test-coverage-analyzer
- **目的**: テストカバレッジの向上
- **機能**: カバレッジギャップの検出と改善提案
- **効果**: テスト品質の向上
- **TDD責務**: 「t_wadaだったら、カバレッジは結果であって目標ではない。しかし、カバレッジの低い箇所は設計の臭いのサイン。テスタビリティの観点から設計を見直す機会と捉える」

### 5. test-performance-optimizer
- **目的**: テスト実行時間の短縮
- **機能**: 並列実行可能テストの検出、実行順序最適化
- **効果**: 開発効率の向上
- **TDD責務**: 「t_wadaだったら、テストは高速でなければならない。単体テストは1秒以内、全テストスイートも数秒で完了すべき。遅いテストはTDDリズムを壊す」

### 6. test-edge-case-generator
- **目的**: エッジケースの網羅的なテスト
- **機能**: 境界値、異常値のテストケース自動生成
- **効果**: バグ検出率の向上
- **TDD責務**: 「t_wadaだったら、明白な実装から始めて、三角測量でエッジケースを発見する。パラメータ化テストで境界値を体系的に検証し、プロパティベーステストで想定外のケースを探索する」

### 7. test-deduplication-analyzer
- **目的**: 重複テストの削減
- **機能**: 類似テストの検出と統合提案
- **効果**: テストコードの保守性向上
- **TDD責務**: 「t_wadaだったら、DRY原則はプロダクションコードだけでなくテストコードにも適用する。ただし、テストの可読性を損なう抽象化は避ける。明確性が最優先」

### 8. test-documentation-generator
- **目的**: テストドキュメントの充実
- **機能**: テスト仕様書、カバレッジレポートの自動生成
- **効果**: プロジェクト品質の可視化
- **TDD責務**: 「t_wadaだったら、テスト自体が最良のドキュメント。テストメソッド名と構造で仕様を表現し、追加ドキュメントは補助的なもの。Living Documentationの実現」

## 実装優先順位

1. **Phase 1** (必須): 基盤となるサブエージェントから開始
2. **Phase 2**: コア機能の実装
3. **Phase 3**: 品質向上に関わる機能
4. **Phase 4**: 最適化と効率化

## 参考情報

- 詳細な実装計画は `/tmp/subagent-creation-plan.md` を参照
- 各サブエージェントの詳細設計は `/tmp/subagent-detailed-design.md` を参照
- 各サブエージェントはプロジェクトの `.claude/agents/` ディレクトリに配置（Claude Code標準に準拠）
- ファイル名は小文字とハイフンを使用（例: `test-factory-generator.md`）
- サブエージェント間の連携も考慮した設計とする

## 注意事項

- 各サブエージェントは独立して動作可能な設計とする
- エラーハンドリングを適切に実装し、予期しない状況でも安全に動作するようにする
- 既存のテストコードに影響を与えないよう慎重に実装する
- ドキュメントは日本語と英語の両方で作成することが望ましい

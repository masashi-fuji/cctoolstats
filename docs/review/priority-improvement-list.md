# 優先度付き改善実施リスト

## 実施状況サマリー
- **総項目数**: 26項目
- **完了**: 0項目
- **進行中**: 0項目
- **未着手**: 26項目

---

## 🔴 最優先項目（即座に実施）

### 1. テストヘルパー/ファクトリの実装
**影響範囲**: 全テストファイル  
**推定工数**: 4時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] `tests/helpers/test-data-factory.ts` の作成
- [ ] 基本的なログエントリー生成関数の実装
  - [ ] `createLogEntry()`
  - [ ] `createToolUseEntry()`
  - [ ] `createSubagentEntry()`
- [ ] ディレクトリ構造モックヘルパーの実装
  - [ ] `mockDirectoryStructure()`
  - [ ] `mockDirectoryWithError()`
- [ ] 各テストファイルでの置き換え
  - [ ] claude-log-parser.test.ts
  - [ ] stream-parser.test.ts
  - [ ] tool.test.ts
  - [ ] subagent.test.ts

### 2. parser.test.ts の充実
**影響範囲**: `tests/unit/parser.test.ts`  
**推定工数**: 3時間  
**依存関係**: テストヘルパー実装後が望ましい

#### 実装チェックリスト
- [ ] 正常系テストケースの追加
  - [ ] 単一ツール呼び出しのパース
  - [ ] 複数ツール呼び出しのパース
  - [ ] ネストされたツール呼び出し
  - [ ] Task tool with subagent
- [ ] エラー処理テストの追加
  - [ ] 不正な JSON の処理
  - [ ] 必須フィールド欠落
  - [ ] 型不一致の処理
- [ ] 境界値テストの追加
  - [ ] 空入力
  - [ ] 巨大入力
  - [ ] 深くネストした構造

### 3. cli.test.ts と cli-commander.test.ts の重複解消
**影響範囲**: CLI 関連テスト  
**推定工数**: 2時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] 重複箇所の特定とドキュメント化
- [ ] 責任範囲の明確化
  - [ ] cli.test.ts: CLI エントリーポイントのテスト
  - [ ] cli-commander.test.ts: Commander.js 固有機能のテスト
- [ ] 重複テストの削除または統合
- [ ] 共通テストユーティリティの作成

---

## 🟠 高優先度項目（1週間以内）

### 4. AAA パターンの適用
**影響範囲**: 全テストファイル  
**推定工数**: 4時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] コアロジック系テストへの適用（6ファイル）
- [ ] CLI・出力系テストへの適用（4ファイル）
- [ ] ユーティリティ系テストへの適用（2ファイル）
- [ ] テストテンプレートの作成

### 5. 統合テストの高速化
**影響範囲**: `tests/integration/cli.test.ts`  
**推定工数**: 3時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] プロセス起動をインプロセス実行に変更
- [ ] `captureOutput` ヘルパー関数の実装
- [ ] 並行実行可能なテストの特定
- [ ] テスト実行時間の計測と比較

### 6. エラーケース・エッジケースの追加（Phase 1）
**影響範囲**: 優先度の高いテストファイル  
**推定工数**: 5時間  
**依存関係**: テストヘルパー実装後が望ましい

#### 実装チェックリスト
- [ ] ファイル読み込みエラーのテスト
  - [ ] 権限エラー（EACCES）
  - [ ] ファイル不存在（ENOENT）
  - [ ] ディレクトリを誤ってファイルとして読む
- [ ] 破損データのテスト
  - [ ] 不正な JSON
  - [ ] 型不一致
  - [ ] 必須フィールド欠落
- [ ] 境界値テスト
  - [ ] 空ファイル/データ
  - [ ] 巨大ファイル（>100MB）
  - [ ] 深いネスト（>10レベル）

---

## 🟡 中優先度項目（2週間以内）

### 7. パラメータ化テストの導入
**影響範囲**: CLI オプションテスト、フォーマッターテスト  
**推定工数**: 3時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] CLI オプションテストのパラメータ化
  - [ ] フラグオプションのグループ化
  - [ ] 値付きオプションのグループ化
- [ ] フォーマッターテストのパラメータ化
  - [ ] 出力フォーマットのバリエーション
  - [ ] データパターンのバリエーション
- [ ] テストマトリックスの文書化

### 8. スナップショットテストの導入
**影響範囲**: フォーマッターテスト  
**推定工数**: 2時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] Vitest のスナップショット機能の設定
- [ ] テーブルフォーマッターのスナップショット作成
- [ ] JSON フォーマッターのスナップショット作成
- [ ] CSV フォーマッターのスナップショット作成
- [ ] スナップショット更新ワークフローの文書化

### 9. テンポラリファイル管理の改善
**影響範囲**: 統合テスト  
**推定工数**: 1時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] os.tmpdir() を使用した一意のディレクトリ生成
- [ ] 自動クリーンアップの実装
- [ ] 並行実行対応の確認

### 10. モック設定の簡潔化
**影響範囲**: ユーティリティテスト  
**推定工数**: 2時間  
**依存関係**: テストヘルパー実装後

#### 実装チェックリスト
- [ ] ファイルシステムモックヘルパーの作成
- [ ] エラーモックヘルパーの作成
- [ ] 既存モックコードの置き換え

---

## 🟢 低優先度項目（継続的改善）

### 11. パフォーマンステストの追加
**影響範囲**: 統合テスト  
**推定工数**: 3時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] ベンチマークテストの設定
- [ ] 大量ファイル処理のテスト
- [ ] メモリ使用量の測定
- [ ] パフォーマンス基準値の設定

### 12. 国際化対応テスト
**影響範囲**: フォーマッター  
**推定工数**: 2時間  
**依存関係**: なし

#### 実装チェックリスト
- [ ] ロケール設定のテスト
- [ ] 数値フォーマットのテスト
- [ ] 日付フォーマットのテスト
- [ ] 千位区切りのテスト

### 13. エラーケース・エッジケースの追加（Phase 2）
**影響範囲**: 残りのテストファイル  
**推定工数**: 3時間  
**依存関係**: Phase 1 完了後

#### 実装チェックリスト
- [ ] 並行処理のテスト
- [ ] 競合状態のテスト
- [ ] タイムアウトのテスト
- [ ] メモリ不足のシミュレーション

### 14. テストドキュメントの更新
**影響範囲**: ドキュメント  
**推定工数**: 2時間  
**依存関係**: 主要な改善完了後

#### 実装チェックリスト
- [ ] テスト実行ガイドの更新
- [ ] テスト作成ガイドラインの作成
- [ ] TDD プラクティスガイドの作成
- [ ] トラブルシューティングガイドの作成

---

## 進捗トラッキング

### Week 1 目標
- [ ] テストヘルパー/ファクトリの実装
- [ ] parser.test.ts の充実
- [ ] AAA パターンの適用（コアロジック系）

### Week 2 目標
- [ ] 統合テストの高速化
- [ ] エラーケースの追加（Phase 1）
- [ ] AAA パターンの適用（CLI・出力系）

### Week 3 目標
- [ ] テスト重複の解消
- [ ] パラメータ化テストの導入
- [ ] AAA パターンの適用（ユーティリティ系）

### Week 4 目標
- [ ] スナップショットテストの導入
- [ ] 残りのエラーケース追加
- [ ] ドキュメント更新

---

## 完了基準

各項目は以下の基準を満たした時点で完了とする：

1. **コード実装完了**: 計画したコードがすべて実装されている
2. **テスト通過**: 新規・既存のテストがすべて通過している
3. **レビュー完了**: コードレビューで承認されている
4. **ドキュメント更新**: 必要なドキュメントが更新されている

---

## リスク管理

| リスク | 発生確率 | 影響度 | 対策 |
|--------|----------|--------|------|
| 既存テストの破壊 | 中 | 高 | 段階的移行、CI での継続的確認 |
| 工数超過 | 中 | 中 | 優先度に基づく段階実装 |
| パフォーマンス劣化 | 低 | 中 | ベンチマーク測定、最適化 |
| チーム理解不足 | 低 | 低 | ペアプロ、詳細なドキュメント |

---

## 備考

- 各項目の実装時は、必ず対応するテストを実行して動作確認すること
- 大きな変更を行う際は、事前にブランチを作成し、PR でレビューを受けること
- 進捗は定期的に更新し、チームで共有すること